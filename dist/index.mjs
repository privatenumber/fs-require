import w from"vm";import a from"path";import j,{createRequire as C}from"module";var E=C(import.meta.url);const R=/^[./]/,S=e=>!R.test(e),b=/^(?:node:)?((?:@[\da-z][\w.-]+\/)?[\da-z][\w.-]+)(\/.+)?$/,F=e=>{var r;return(r=e.match(b))==null?void 0:r.slice(1,3)},_=E;function g(e,r,i){var n;const[o,t]=(n=F(r))!=null?n:[];if(o==="fs"){const{fs:c}=i!=null?i:{};if(c!==!0){const s=c||e;if(!t)return s;if(t==="/promises"&&"promises"in s)return s.promises;throw new Error(`Cannot find module '${r}'`)}}return _(r)}const m=[".js",".json"],h=new RegExp(`(${m.map(e=>e.replace(/\./g,"\\$&")).join("|")})$`),B=(e,r)=>e.lstatSync(r).isDirectory();function d(e,r,i){var n,o;if(!a.isAbsolute(r)&&i&&(r=a.resolve(a.dirname(i.filename),r)),e.existsSync(r))return B(e,r)?d(e,a.join(r,"index.js"),i)||d(e,a.join(r,"index.json"),i):{extension:(o=(n=r.match(h))==null?void 0:n[0])!=null?o:"",filePath:r};for(const t of m){const c=r+t;if(e.existsSync(c))return{extension:t,filePath:c}}return null}function q(e,r,i){const n=d(e,r,i);if(!n)throw new Error(`Cannot find module '${r}'`);return n}const p={"":void 0,".js":void 0,".json":void 0};p[""]=function(e,r,i,n,o){const t=j.wrap(r);w.runInThisContext(t,{filename:`fs-require://${o}${n}`,lineOffset:0,displayErrors:!0})(e.exports,i(e),e,a.basename(n),a.dirname(n))},p[".js"]=p[""],p[".json"]=function(e,r){e.exports=JSON.parse(r)};let $=0;const O=(e,r)=>{$+=1;const i=$,n=Object.create(null);function o(t){const c=u=>S(u)?u:q(e,u,t).filePath,s=u=>{var v;if(S(u))return g(e,u,r);const x=q(e,u,t),{filePath:l}=x;let f=n[l];if(!f){f=new j(l,t||void 0),f.filename=l;const y=e.readFileSync(l).toString();(v=p[x.extension])==null||v.call(p,f,y,o,l,i),n[l]=f}return f.exports};return s.id=i,s.resolve=c,s.cache=n,s}return o(typeof module>"u"?void 0:module.parent)};export{O as createFsRequire};
